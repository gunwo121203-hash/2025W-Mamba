# 🧠 NeuroMamba 논문 정리

> **NeuroMamba: A State-Space Foundation Model for Functional MRI**

---

## 📋 목차
1. [기존 fMRI 파운데이션 모델의 한계](#기존-fmri-파운데이션-모델의-한계)
2. [NeuroMamba의 핵심 해결책](#neuromamba의-핵심-해결책)
3. [핵심 개념 설명](#핵심-개념-설명)
4. [fMRI 4D 데이터 구조](#fmri-4d-데이터-구조)
5. [관련 연구 비교](#관련-연구-비교)
6. [Method 상세](#method-상세)
7. [논문의 의의](#논문의-의의)

---

## 🔴 기존 fMRI 파운데이션 모델의 한계

### 1. ROI (Region-of-Interest) 접근 방식
| 특징      | 설명                                                         |
| --------- | ------------------------------------------------------------ |
| 방식      | 뇌 영역을 미리 정의하고 해당 영역의 활동을 **평균**하여 분석 |
| 장점      | 계산 효율적                                                  |
| **단점**  | ⚠️ 미세한 공간 정보 소실                                      |
| 대표 모델 | BrainLM, Brain-JEPA                                          |

### 2. 계층적 (Hierarchical) 모델
| 특징         | 설명                                                       |
| ------------ | ---------------------------------------------------------- |
| 방식         | Transformer/Mamba 기반, End-to-End로 미세 공간 정보 유지   |
| **문제점 1** | 🚫 배경 영역(데이터의 최대 60%)까지 처리 → 계산 비효율      |
| **문제점 2** | 🚫 고정된 그리드 구조 → 피험자 간 해부학적 차이 대응 어려움 |
| 대표 모델    | SwiFT, NeuroSTORM                                          |

---

## 🟢 NeuroMamba의 핵심 해결책

### 기본 아키텍처
```
Mamba 백본 + 시공간 패치 + 자동회귀 학습
```

### 2가지 핵심 혁신

| 혁신                          | 해결하는 문제 | 설명                                     |
| ----------------------------- | ------------- | ---------------------------------------- |
| **🎯 적응적 배경 신호 제거**   | 계산 비효율성 | 불필요한 배경 토큰을 동적으로 제거       |
| **📍 주파수 기반 위치 인코딩** | 해부학적 변이 | NeRF 영감, sin/cos 주기 함수로 위치 표현 |

---

## 📚 핵심 개념 설명

### 🔄 자동회귀 (Autoregressive) 훈련

> **정의**: 이전 관측값들을 기반으로 다음 관측값을 예측하는 방식
> 
> `Auto(자기) + Regressive(회귀)` = 자신의 과거로 미래 예측

#### NeuroMamba에서의 적용
```
4D fMRI 볼륨 → 시공간 패치로 분할 → 시퀀스로 나열

[패치1] → [패치2] → [패치3] → [???]
                              ↑
                         모델이 예측!
```

- **"Next-token prediction"**: 이전 패치들을 보고 다음 패치 예측
- **장점**: 
  - ✅ 레이블 없는 데이터로 학습 가능 (Self-supervised)
  - ✅ 다양한 다운스트림 태스크로 일반화 가능

---

### 📍 주파수 기반 위치 인코딩

> **영감**: Neural Radiance Fields (NeRF)

#### 원리
```
4D 좌표 (x, y, z, t) → sin/cos 주기 함수 → 고차원 임베딩
```

마치 **푸리에 변환**처럼 위치 정보를 다양한 주파수 성분으로 분해

#### 효과
| 장점                   | 설명                                           |
| ---------------------- | ---------------------------------------------- |
| 미세 위치 민감성       | 작은 위치 변화에도 민감하게 반응               |
| 전체 구조 파악         | 전반적인 공간 구조 인식 가능                   |
| **해부학적 변이 대응** | 피험자마다 뇌 구조가 조금씩 달라도 일반화 가능 |

> 💡 좌표 + 시간 패치 기반으로 **시공간적 특징**을 반영하여 해부학적 변이에 강건함

---

### 🎭 배경 제거 (Non-brain Token Removal)

#### 문제
- fMRI 데이터의 **최대 60%**가 뇌가 아닌 배경
- 기존 그리드 기반 모델은 이 배경도 모두 처리 → 낭비

#### NeuroMamba 해결책
```
전체 패치 → 뇌 영역 토큰만 선별 → Mamba 모델에 입력
```

**패치 단위 토큰화 + 비뇌 토큰 제거**

---

## 🧊 fMRI 4D 데이터 구조

### 차원 구성

| 차원  | 이름 | 설명                  |
| ----- | ---- | --------------------- |
| X     | 가로 | 뇌의 좌우 방향        |
| Y     | 세로 | 뇌의 전후 방향        |
| Z     | 깊이 | 뇌의 상하 방향        |
| **T** | 시간 | 뇌 활동의 시간적 변화 |

### 기본 단위

| 용어                     | 설명                                    |
| ------------------------ | --------------------------------------- |
| **복셀 (Voxel)**         | 3D 픽셀, 공간의 가장 작은 단위          |
| **TR (Repetition Time)** | 하나의 3D 볼륨 촬영 시간 (보통 0.5~3초) |

### NeuroMamba 패치 구성

```
                    ┌─────────────────────────┐
                    │   96 × 96 × 96 × T      │
                    │   (공간)   (공간) (시간)  │
                    └───────────┬─────────────┘
                                │
                    패치 크기: 6 × 6 × 6 × 2
                                │
                                ▼
                    16 × 16 × 16 × (T/2) 개의 패치
```

---

## 📊 관련 연구 비교

### fMRI 파운데이션 모델 분류

```
fMRI 파운데이션 모델
├── ROI 기반
│   ├── BrainLM
│   └── Brain-JEPA
│
└── Whole-brain 기반
    ├── SwiFT (Transformer)
    ├── NeuroSTORM (Mamba, 그리드)
    └── NeuroMamba (Mamba, 패치 시퀀스) ✨
```

### SwiFT vs NeuroMamba

| 특징        | SwiFT            | NeuroMamba         |
| ----------- | ---------------- | ------------------ |
| 아키텍처    | Swin Transformer | Mamba              |
| 어텐션 방식 | 윈도우 어텐션    | 상태 공간 모델     |
| 데이터 처리 | 고정 그리드      | 적응적 패치 시퀀스 |
| 배경 처리   | 포함             | **제거**           |

### 그리드 기반 vs 패치 기반

| 구분      | 그리드 기반           | 패치 기반                 |
| --------- | --------------------- | ------------------------- |
| 구조      | 고정된 3D 그리드 유지 | 패치를 1D 시퀀스로 변환   |
| 유연성    | 낮음                  | **높음**                  |
| 배경 처리 | 어려움                | 토큰 단위로 **제거 가능** |
| 대표 모델 | NeuroSTORM            | **NeuroMamba**            |

> 💡 **핵심 차이**: 패치들을 그리드로 유지할 것인가 vs 시퀀스로 만들어 유연하게 처리할 것인가

---

### 기존 Mamba 기반 fMRI 연구의 한계

| 모델                  | 한계점                                            |
| --------------------- | ------------------------------------------------- |
| **Causal fMRI-Mamba** | 지도 학습 방식, 특정 태스크에만 초점              |
| **FST-Mamba**         | 원본 복셀 대신 dFNC 행렬(압축된 요약 데이터) 사용 |

### NeuroMamba의 독창성

> 🎯 **최초로** fMRI를 거대한 시공간 시퀀스 모델링 문제로 정의
> 
> ✅ 원시 복셀 데이터 + 자기 지도 사전 학습 + Mamba로 End-to-End 처리

---

## 🔬 Method 상세

### 패치 시퀀스 나열 순서

```
시간(t) → 깊이(z) → 세로(y) → 가로(x)
```

### 학습 데이터 규모

| 데이터셋   | 피험자 수         |
| ---------- | ----------------- |
| UK Biobank | 40,647명          |
| ABCD       | 9,139명           |
| HCP        | 1,084명           |
| **총계**   | **50,870명 이상** |

### 토큰 수 추정
```
50,870 스캔 × ~20,000 패치/스캔 ≈ 10억 개 이상의 토큰
```

### Scaling Law 분석

```
Y축: Validation Loss (↓ 낮을수록 좋음)
X축: Compute (PF-days, 연산량)

        │
Loss    │    ╲
        │     ╲  작은 모델
        │      ╲___________
        │        ╲
        │         ╲  큰 모델
        │          ╲________
        └──────────────────── Compute
```

> ⚠️ 가장 큰 모델에서 성능이 불안정해지는 현상 관찰됨

---

## 🏆 논문의 의의

### 핵심 기여

| #   | 기여                                                 |
| --- | ---------------------------------------------------- |
| 1️⃣   | Mamba를 이용한 **자기회귀적 fMRI 시퀀스 모델링**     |
| 2️⃣   | **적응적 배경 제거** + **주파수 기반 위치 인코딩**   |
| 3️⃣   | 성별 분류 등 다운스트림 태스크에서 **안정적인 성능** |

### 추가 응용 가능성

| 응용 분야     | 설명                                        |
| ------------- | ------------------------------------------- |
| 교차 모달     | 뇌-이미지 검색 (뇌 활동 → 연상 이미지 추정) |
| 임상 진단     | 뇌 질환 분류/예측                           |
| 인지 신경과학 | 뇌 활동 패턴 분석                           |

---

## 📝 추가 학습 필요 사항

- [ ] 주파수 기반 위치 인코딩 수학적 이해
- [ ] Mamba (State Space Model) 아키텍처 심화
- [ ] NeRF의 위치 인코딩 방식

---

## 🔗 참고 자료

- NeuroMamba 논문: [arXiv 링크]
- SwiFT 논문: Swin 4D fMRI Transformer
- Mamba 원 논문: State Space Models

---

*마지막 업데이트: 2026.01*

